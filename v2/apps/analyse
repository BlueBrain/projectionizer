#!/usr/bin/env python
import logging
import os
from os.path import join

import luigi
import matplotlib.pyplot as plt

from apps.parser import common_parser, luigi_params

L = logging.getLogger(__name__)


def main(args):
    logging.basicConfig(level=logging.DEBUG)
    cmd = ['Analyse',
           '--module', 'projectionizer.analysis',
           '--folder', args.output, '--local-scheduler']

    cmd += luigi_params(join(args.output, 'config.yaml'), args)
    L.debug('Running command: {}'.format(cmd))
    luigi.run(cmd)
    if args.show:
        plt.show()


if __name__ == '__main__':
    parser = common_parser()
    parser.add_argument('-s', '--show',  action='store_true', help='Call plt.show() at the end')

    main(parser.parse_args())
